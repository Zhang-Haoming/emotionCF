
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A Python package to perform collaborative filtering on emotion datasets">
      
      
      
      
        <link rel="canonical" href="https://cosanlab.github.io/emotionCF/">
      
      <link rel="shortcut icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.2.8">
    
    
      
        <title>EmotionCF</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.cb6bc1d0.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.39b8e14a.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#emotion-cf" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="https://cosanlab.github.io/emotionCF" title="EmotionCF" class="md-header-nav__button md-logo" aria-label="EmotionCF">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      <div class="md-header-nav__ellipsis">
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            EmotionCF
          </span>
        </div>
        <div class="md-header-nav__topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/cosanlab/emotionCF/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cosanlab/emotioncf
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    




<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="https://cosanlab.github.io/emotionCF" title="EmotionCF" class="md-nav__button md-logo" aria-label="EmotionCF">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    EmotionCF
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/cosanlab/emotionCF/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    cosanlab/emotioncf
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Home
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        Home
      </a>
      
        
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    Example Usage
  </a>
  
    <nav class="md-nav" aria-label="Example Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-subject-by-item-matrix" class="md-nav__link">
    Create a subject by item matrix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize-a-model-instance" class="md-nav__link">
    Initialize a model instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-data-into-train-and-test" class="md-nav__link">
    Split Data into Train and Test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estimate-model" class="md-nav__link">
    Estimate Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predict-new-ratings" class="md-nav__link">
    Predict New Ratings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model-predictions" class="md-nav__link">
    Evaluate Model Predictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mean" class="md-nav__link">
    Mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k-nearest-neighbors" class="md-nav__link">
    K-Nearest Neighbors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-negative-matrix-factorization-using-stochastic-gradient-descent" class="md-nav__link">
    Non-negative matrix factorization using stochastic gradient descent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-negative-matrix-factorization-using-multiplicative-updating" class="md-nav__link">
    Non-negative matrix factorization using multiplicative updating
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-time-series-data" class="md-nav__link">
    Working with Time-Series Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="development/" class="md-nav__link">
        Development
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3" >
      
      <label class="md-nav__link" for="nav-3">
        API Reference
        <span class="md-nav__icon md-icon"></span>
      </label>
      <nav class="md-nav" aria-label="API Reference" data-md-level="1">
        <label class="md-nav__title" for="nav-3">
          <span class="md-nav__icon md-icon"></span>
          API Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
          
            
  
  
  
    <li class="md-nav__item">
      <a href="api/data/" class="md-nav__link">
        data
      </a>
    </li>
  

          
            
  
  
  
    <li class="md-nav__item">
      <a href="api/cf/" class="md-nav__link">
        cf
      </a>
    </li>
  

          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example-usage" class="md-nav__link">
    Example Usage
  </a>
  
    <nav class="md-nav" aria-label="Example Usage">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-a-subject-by-item-matrix" class="md-nav__link">
    Create a subject by item matrix
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#initialize-a-model-instance" class="md-nav__link">
    Initialize a model instance
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#split-data-into-train-and-test" class="md-nav__link">
    Split Data into Train and Test
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#estimate-model" class="md-nav__link">
    Estimate Model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#predict-new-ratings" class="md-nav__link">
    Predict New Ratings
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#evaluate-model-predictions" class="md-nav__link">
    Evaluate Model Predictions
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#mean" class="md-nav__link">
    Mean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#k-nearest-neighbors" class="md-nav__link">
    K-Nearest Neighbors
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-negative-matrix-factorization-using-stochastic-gradient-descent" class="md-nav__link">
    Non-negative matrix factorization using stochastic gradient descent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#non-negative-matrix-factorization-using-multiplicative-updating" class="md-nav__link">
    Non-negative matrix factorization using multiplicative updating
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#working-with-time-series-data" class="md-nav__link">
    Working with Time-Series Data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/cosanlab/emotionCF/edit/master/docs/index.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                <h1 id="emotion-cf">Emotion CF</h1>
<p><a href="https://travis-ci.org/cosanlab/emotionCF"><img alt="Build Status" src="https://travis-ci.org/cosanlab/emotionCF.svg?branch=master" /></a>
<a href="https://coveralls.io/github/ljchang/emotionCF?branch=master"><img alt="Coverage Status" src="https://coveralls.io/repos/github/ljchang/emotionCF/badge.svg?branch=master" /></a></p>
<p><strong>A Python package for collaborative filtering on emotion datasets</strong></p>
<h2 id="installation">Installation</h2>
<div class="highlight"><pre><span></span><code>pip install git+https://github.com/cosanlab/emotionCF.git
</code></pre></div>
<h2 id="example-usage">Example Usage</h2>
<p>All algorithms in the emotionCF toolbox operates on 2d pandas dataframes with rows as unique <em>users</em> and columns as unique <em>items</em>.  </p>
<h3 id="create-a-subject-by-item-matrix">Create a subject by item matrix</h3>
<p>The toolbox contains a helper function <code>create_sub_by_item_matrix()</code> to convert a long-form dataframe into this format provided it has 3 columns named <code>['Subject', 'Item', 'Rating']</code> or equivalent (see the <code>columns</code> keyword argument of <code>create_sub_by_item_matrix</code> ).</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">emotioncf.data</span> <span class="kn">import</span> <span class="n">create_sub_by_item_matrix</span>

<span class="n">ratings</span> <span class="o">=</span> <span class="n">create_sub_by_item_matrix</span><span class="p">(</span><span class="n">long_format_df</span><span class="p">)</span>
</code></pre></div>
<h3 id="initialize-a-model-instance">Initialize a model instance</h3>
<p>Before you can fit a model on your data you need to initialize a new model instance by passing in your user x item dataframe:</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">emotioncf.cf</span> <span class="kn">import</span> <span class="n">KNN</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">KNN</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
</code></pre></div>
<h3 id="split-data-into-train-and-test">Split Data into Train and Test</h3>
<p>It is easy to split your data into training and test sets using the <code>split_train_test()</code> method on any model instance. This creates a binary mask saved into the model object itself and accessible at <code>model.train_mask</code>. Unlike libraries like <code>sklearn</code>, splitting data this way chooses a <em>different</em> random subset of <em>items</em> per user to perform training. All <em>users</em> are always included in training set, but each user will have a different random set of <em>items</em>.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># use 50% of the items for training per user</span>
<span class="n">cf</span><span class="o">.</span><span class="n">split_train_test</span><span class="p">(</span><span class="n">n_train_items</span><span class="o">=.</span><span class="mi">5</span><span class="p">)</span> 
<span class="c1"># contains the training mask:</span>
<span class="n">cf</span><span class="o">.</span><span class="n">train_mask</span>
</code></pre></div>
<h3 id="estimate-model">Estimate Model</h3>
<p>Each model can be estimated using its <code>fit()</code> method. If no data splitting is done, then <em>all data</em> is used for training.</p>
<div class="highlight"><pre><span></span><code><span class="n">cf</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
</code></pre></div>
<h3 id="predict-new-ratings">Predict New Ratings</h3>
<p>To generate predictions, used a model's <code>predict()</code> method. This creates a pandas dataframe of the predicted subject by item matrix within the model object itself, accessible at <code>model.predicted_ratings</code>.</p>
<div class="highlight"><pre><span></span><code><span class="n">cf</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
</code></pre></div>
<h3 id="evaluate-model-predictions">Evaluate Model Predictions</h3>
<p>There are several methods to aid in evaluating the performance of the model including:
- overall mean squared error <code>.get_mse()</code>
- overall correlation <code>.get_corr()</code>
- mean-squared-error separately per user <code>.get_sub_mse()</code>
- correlation for each subject <code>.get_sub_corr()</code></p>
<p>Additionally, each method takes a string argument to indicate what dataset performance should be calculated for: <code>'train'</code>, <code>'test'</code>, or <code>'all'</code>. Defaults to <code>'test'</code>. </p>
<div class="highlight"><pre><span></span><code><span class="n">cf</span><span class="o">.</span><span class="n">get_mse</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_corr</span><span class="p">()</span> <span class="c1"># &#39;test&#39;</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_sub_corr</span><span class="p">(</span><span class="s1">&#39;train&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="mean">Mean</h3>
<p>An easy control model for collaborative filtering is to demonstrate how well the models perform over simply using the item means.  We initialize a class instance and then the model can be estimated and new ratings predicted.  We can get the overall mean squared error on the predicted ratings.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">emotioncf.cf</span> <span class="kn">import</span> <span class="n">Mean</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">Mean</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">cf</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_mse</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="k-nearest-neighbors">K-Nearest Neighbors</h3>
<p>EmotionCF uses a standard API to estimate and predict data.  Though the KNN approach is not technically a model, we still use the fit method to estimate data.  This calculates a similarity matrix between subjects using ['correlation','cosine'] methods.  We can then predict the left out ratings using the top <code>k</code> nearest neighbors.  We can evaluate how well the model works for all data points using <code>get_corr()</code> and <code>get_mse()</code> methods.  We can also get the correlation for each subject's individual data using <code>get_sub_corr()</code> method.  So far we have found that this method does not perform well when there aren't many overlapping samples across items and users.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">emotioncf.cf</span> <span class="kn">import</span> <span class="n">KNN</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">KNN</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">split_train_test</span><span class="p">(</span><span class="n">n_train_items</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">metric</span><span class="o">=</span><span class="s1">&#39;pearson&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">k</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_mse</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_corr</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_sub_corr</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
</code></pre></div>
<h3 id="non-negative-matrix-factorization-using-stochastic-gradient-descent">Non-negative matrix factorization using stochastic gradient descent</h3>
<p>Here we initialize a new class instance and split the data into 20 training and 80 test items per subject.  We fit the model using 100 iterations.  Can pass in optional regularization parameters and a learning rate for the update function.  The model is then used to predict the left out ratings.  We can get the overall model MSE and correlation value on the test ratings.  We can also make a quick plot of the results. As indicated by the name, this method does not work with data that includes negative numbers.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">emotioncf.cf</span> <span class="kn">import</span> <span class="n">NNMF_sgd</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">NNMF_sgd</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">split_train_test</span><span class="p">(</span><span class="n">n_train_items</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
       <span class="n">user_fact_reg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
       <span class="n">item_fact_reg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
       <span class="n">user_bias_reg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
       <span class="n">item_bias_reg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
       <span class="n">learning_rate</span><span class="o">=.</span><span class="mi">001</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_mse</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_corr</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">plot_predictions</span><span class="p">()</span>
</code></pre></div>
<h3 id="non-negative-matrix-factorization-using-multiplicative-updating">Non-negative matrix factorization using multiplicative updating</h3>
<p>Similarly, we can fit a different NNMF model that uses multiplicative updating with the <code>NNMF_multiplicative</code> class.</p>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">emotioncf.cf</span> <span class="kn">import</span> <span class="n">NNMF_multiplicative</span>

<span class="n">cf</span> <span class="o">=</span> <span class="n">NNMF_multiplicative</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">split_train_test</span><span class="p">(</span><span class="n">n_train_items</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">max_iterations</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_mse</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_corr</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">plot_predictions</span><span class="p">()</span>
</code></pre></div>
<h3 id="working-with-time-series-data">Working with Time-Series Data</h3>
<p>This tool has also been designed to work with time-series data.</p>
<p>For example, cf instances can be downsampled across items, where items refers to time samples. You must specify the <code>sampling_freq</code> of the data, and the <code>target</code>, where target must have a <code>target_type</code> of ['hz','samples','seconds'].  Downsampling is performed by averaging over bin windows.  In this example we downsample a dataset from 10Hz to 5Hz.</p>
<div class="highlight"><pre><span></span><code><span class="n">cf</span><span class="o">.</span><span class="n">downsample</span><span class="p">(</span><span class="n">sampling_freq</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span><span class="n">target</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">target_type</span><span class="o">=</span><span class="s1">&#39;hz&#39;</span><span class="p">)</span>
</code></pre></div>
<p>It is also possible to leverage presumed autocorrelation when training models by using the <code>dilate_ts_n_samples=n_samples</code> keyword.  This flag will convolve a boxcar regressor with each subject's sample from <code>cf.train_mask</code> <code>n_samples</code>.  The dilation will be centered on each sample.  The intuition here is that if a subject rates an item at a given time point, say '50', they likely will have rated time points immediately preceding and following similarly (e.g., [50,50,50]).  This is due to autocorrelation in the data.  More presumed autocorrelation will likely benefit from a higher number of samples being selected.  This will allow time series that are sparsely sampled to be estimated more accurately.</p>
<div class="highlight"><pre><span></span><code><span class="n">cf</span> <span class="o">=</span> <span class="n">NNMF_sgd</span><span class="p">(</span><span class="n">ratings</span><span class="p">)</span>
<span class="n">mask</span> <span class="o">=</span> <span class="n">cf</span><span class="o">.</span><span class="n">train_mask</span>
<span class="n">cf</span><span class="o">.</span><span class="n">split_train_test</span><span class="p">(</span><span class="n">n_train_items</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">n_iterations</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
     <span class="n">user_fact_reg</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
     <span class="n">item_fact_reg</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> 
     <span class="n">user_bias_reg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
     <span class="n">item_bias_reg</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
     <span class="n">learning_rate</span><span class="o">=.</span><span class="mi">001</span><span class="p">,</span>
     <span class="n">dilate_ts_n_samples</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">predict</span><span class="p">()</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_mse</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">get_corr</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">)</span>
<span class="n">cf</span><span class="o">.</span><span class="n">plot_predictions</span><span class="p">()</span>
</code></pre></div>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
        
          <a href="development/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Development
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="assets/javascripts/vendor.18f0862e.min.js"></script>
      <script src="assets/javascripts/bundle.994580cf.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: ".",
          features: [],
          search: Object.assign({
            worker: "assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>